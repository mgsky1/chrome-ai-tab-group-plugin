# 调试指南

## 如何查看日志

### 1. 打开 Service Worker 控制台

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 找到"AI标签分组"插件
4. 点击"service worker"链接（在"检查视图"下方）
5. 这会打开 Service Worker 的控制台，所有日志都会显示在这里

### 2. 查看日志的关键步骤

当您点击"AI分组"时，应该能看到以下日志流程：

#### 步骤1: 菜单点击
```
[AI分组] ========== 右键菜单被点击 ==========
[AI分组] 菜单项ID: ai-group-tabs
[AI分组] 当前标签页: ...
```

#### 步骤2: 获取标签页
```
[AI分组] ========== 开始分组流程 ==========
[AI分组] 步骤1: 获取所有标签页...
[AI分组] 所有标签页数量: X
[AI分组] 标签页列表: [...]
```

#### 步骤3: 筛选未分组标签
```
[AI分组] 步骤2: 筛选未分组的标签页...
[AI分组] 未分组标签页数量: X
[AI分组] 未分组标签页标题: [...]
```

#### 步骤4: 初始化AI服务
```
[AI分组] 步骤4: 初始化AI服务...
[DeepSeek] 初始化，读取API Key...
[DeepSeek] ✅ API Key已读取（长度: X）
```

#### 步骤5: 调用DeepSeek API
```
[DeepSeek] ========== 开始调用DeepSeek API ==========
[DeepSeek] 待分组标签数量: X
[DeepSeek] 构建Prompt...
[DeepSeek] 准备发送API请求到: https://api.deepseek.com/v1/chat/completions
[DeepSeek] API请求完成，耗时: X ms
[DeepSeek] 响应状态: 200 OK
[DeepSeek] AI返回的原始内容: ...
[DeepSeek] ✅ 解析完成，分组结果: {...}
```

#### 步骤6: 执行分组
```
[AI分组] 步骤7: 执行分组操作...
[AI分组] 开始执行分组操作...
[AI分组] ✅ 分组完成！
```

## 常见问题排查

### 问题1: 点击后没有任何日志

**可能原因：**
- Service Worker 没有运行
- 右键菜单没有正确创建

**解决方法：**
1. 检查 Service Worker 控制台是否打开
2. 重新加载插件（在 `chrome://extensions/` 页面点击刷新按钮）
3. 查看是否有菜单创建失败的日志

### 问题2: 看到"没有未分组的标签页"

**说明：** 这是正常情况，表示所有标签页都已经分组了。

### 问题3: 看到"API Key未配置"

**解决方法：**
1. 打开插件设置页面
2. 输入 DeepSeek API Key
3. 保存设置
4. 重新尝试分组

### 问题4: API 请求失败

**查看日志中的错误信息：**
- `[DeepSeek] ❌ API请求失败`
- `[DeepSeek] 错误响应: ...`

**可能原因：**
- API Key 无效或过期
- 网络连接问题
- API 服务暂时不可用

### 问题5: JSON 解析失败

**查看日志：**
- `[DeepSeek] ❌ 解析AI响应失败`
- `[DeepSeek] 原始内容: ...`

**可能原因：**
- AI 返回的格式不符合预期
- 需要调整 prompt 或解析逻辑

## 日志级别说明

- `[AI分组]` - 主流程日志
- `[DeepSeek]` - DeepSeek API 相关日志
- `✅` - 成功操作
- `❌` - 错误操作
- `⚠️` - 警告信息

## 导出日志

如果需要导出日志进行问题分析：
1. 在 Service Worker 控制台中右键
2. 选择"另存为..."
3. 保存日志文件

